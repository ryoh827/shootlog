# Repository Guidelines

## プロジェクト構成とモジュール配置
現状のルートは `README.md` と `LICENSE` のみなので、CLI エントリーポイントは `cmd/shootlog/`、ドメイン固有の実装は `internal/exif` や `internal/report` にまとめ、共有可能なユーティリティは `pkg/` 以下へ置いてください。EXIF サンプルや生成済みサマリーは `testdata/` に保管し、設計メモや仕様は `docs/` に整理するとルートがすっきりします。大容量 RAW や個人情報を含む写真は Git 管理外に置き、取得手順を `README.md` で説明してください。
プロジェクトの初期化後は CI 設定や Issue テンプレートも `/.github` に整理すると 貢献フローがより明確になります。

## ビルド・テスト・開発コマンド
- `go mod tidy` — 依存を追加・削除した直後に実行し、`go.mod` と `go.sum` を同期します。
- `go build ./cmd/shootlog` — CLI がコンパイルできるかを確認し、型崩れを早期に検知します。
- `go run ./cmd/shootlog --input sample.jpg` — EXIF 解析の挙動をローカルで素早く検証します。
- `go test ./... -race -cover` — 全テストを並列検出器とカバレッジ付きで実行し、回帰を防ぎます。
- `golangci-lint run` — gofmt/goimports/vet などをまとめて走らせ、スタイルと静的解析を一括で担保します。

## コーディングスタイルと命名
`gofmt` 既定のタブインデントと 120 桁程度のソフト制限を守り、パッケージ名は短い小文字 (`exif`, `catalog`) に統一します。公開シンボルは PascalCase、非公開は camelCase、EXIF タグ由来の定数のみ SCREAMING_SNAKE_CASE を許容します。ファイルは役割ごとに分割し、ディレクトリ名と `package` 名を一致させてください。

## テスト指針
標準の `testing` パッケージでテーブル駆動テストを記述し、`TestComponentBehavior` 形式の命名に揃えます。フィクスチャは `testdata/<scenario>/` に配置し、`os.ReadFile` で読み込みます。ファイルアクセスやメタデータ取得はインターフェースで抽象化してモック化し、パーサー系パッケージでは 80% 以上のカバレッジを維持します。PR 前に `go test ./... -cover` と `-race` の実行ログを確認してください。

## コミットと PR ガイド
履歴は簡潔な命令形タイトル (`Initial commit`) なので、今後も `exif: add maker note parser` のように対象パッケージを接頭辞にした現在形でまとめます。コミット本文には関連するissueがある場合は `Refs #123` のような形でissueを紐づけ、手動検証手順を記載します。PR では課題背景、解決内容、CLI 出力やスクリーンショット、追加したデータソースを説明し、ビルド・テスト・Lint の成功を確認してからレビューを依頼してください。

## セキュリティと設定のヒント
`.env` は無視対象なので API キーやフォルダパスはそこに保存し、コード側は `os.LookupEnv` で存在確認してください。個人情報を含む EXIF はアップロード前に匿名化し、`testdata` へ置く場合はメタデータを編集済みにします。外部依存は必要最小限にとどめ、ライセンス互換性を必ずチェックします。CLI が原本画像を書き換えないよう、安全なデフォルト値と `--force` のような明示的オプションを設けてください。

## アーキテクチャと環境準備
ツールは Go 1.22 以降を前提とし ローカルでは `asdf` や `mise` などのバージョンマネージャーで 共通環境を揃えてください。CLI は EXIF デコーダー 履歴管理 レポート生成の 3 層で構成される想定なので 機能追加時は既存の層を再利用しながら 依存方向が一方向に流れるよう意識します。画像やメタデータを読み込む I/O レイヤーは 明示的なインターフェースで抽象化しておくと エージェント同士で責務を分担しやすく 追加のストレージ実装も容易です。将来的に SQLite や S3 を併用する場合は `internal/store` で アダプタパターンを用いて 既存パーサーが変更不要になるように設計してください。
